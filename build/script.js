"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),constraints=window.constraints={audio:!0,video:!0},videoRecorder=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"startRecording",value:function(){pauseButton.disabled=!1,0==streamingOn&&(e.recordAgain(),document.getElementById("recordingSec").style.display="none"),recorder=new MediaRecorder(stream),recorder.addEventListener("dataavailable",e.onRecordingReady),recordButton.disabled=!0,stopButton.disabled=!1,recorder.start()}},{key:"stopRecording",value:function(){recordButton.disabled=!1,stopButton.disabled=!0,recorder.stop(),stream.getTracks()[0].stop(),stream.getTracks()[1].stop(),streamingOn=0,document.getElementById("live").style.display="none",recordButton.innerHTML="record again"}},{key:"pauseRecording",value:function(){"recording"===recorder.state?(recorder.pause(),pauseButton.innerHTML="Resume"):"paused"===recorder.state&&(recorder.resume(),pauseButton.innerHTML="Pause")}},{key:"localFileVideoPlayer",value:function(){var e=window.URL||window.webkitURL,t=function(e,t){var n=document.querySelector("#message");n.innerHTML=e,n.className=t?"error":"info"},n=function(n){var r=this.files[0],o=r.type,a=document.getElementById("uploadedVid"),d=a.canPlayType(o);""===d&&(d="no");var i='Can play type "'+o+'": '+d,c="no"===d;if(t(i,c),!c){var s=e.createObjectURL(r);a.src=s,document.getElementById("live").style.display="none",document.getElementById("recordingSec").style.display="none",document.getElementById("uploadedVid").style.display="block"}};document.querySelector("input").addEventListener("change",n,!1)}},{key:"onFailure",value:function(e){"ConstraintNotSatisfiedError"===e.name?errorMsg("The resolution "+constraints.video.width.exact+"x"+constraints.video.width.exact+" px is not supported by your device."):"PermissionDeniedError"===e.name&&errorMsg("Permissions have not been granted to use your camera and microphone, you need to allow the page access to your devices in order for the demo to work."),errorMsg("getUserMedia error: "+e.name,e)}},{key:"errorMsg",value:function(e,t){errorElement.innerHTML+="<p>"+e+"</p>",void 0!==t&&console.error(t)}},{key:"readyToStream",value:function(){AdapterJS.webRTCReady(function(t){"undefined"==typeof Promise?navigator.getUserMedia(constraints,e.onSuccess,e.onFailure):navigator.mediaDevices.getUserMedia(constraints).then(e.onSuccess).catch(e.onFailure)})}}],[{key:"recordAgain",value:function(){AdapterJS.webRTCReady(function(t){"undefined"==typeof Promise?navigator.getUserMedia(constraints,e.onSuccess,e.onFailure):navigator.mediaDevices.getUserMedia(constraints).then(e.onSuccess).catch(e.onFailure)}),setTimeout(function(){recordButton.innerHTML="recording",document.getElementById("live").style.display="block",recorder=new MediaRecorder(stream),recorder.addEventListener("dataavailable",e.onRecordingReady),recordButton.disabled=!0,stopButton.disabled=!1,recorder.start()},1e3)}},{key:"onRecordingReady",value:function(e){document.getElementById("recordingSec").style.display="block",document.getElementById("recordingSec").src=URL.createObjectURL(e.data)}},{key:"onSuccess",value:function(e){var t=e.getVideoTracks();console.log("Got stream with constraints:",constraints),console.log("Using video device: "+t[0].label),e.onended=function(){console.log("Stream ended")},window.stream=e;attachMediaStream(liveVideo,e);streamingOn=1}}]),e}(),vr=new videoRecorder;vr.readyToStream();var recorder,liveStream,liveVideo=document.getElementById("live"),recordButton=document.getElementById("record"),stopButton=document.getElementById("stop"),pauseButton=document.getElementById("pause"),errorElement=document.getElementById("errorMsg");pauseButton.disabled=!0,recordButton.disabled=!1,stopButton.disabled=!1,document.getElementById("recordingSec").style.display="none",document.getElementById("uploadedVid").style.display="none";var streamingOn=0;recordButton.addEventListener("click",vr.startRecording),stopButton.addEventListener("click",vr.stopRecording),pauseButton.addEventListener("click",vr.pauseRecording);
